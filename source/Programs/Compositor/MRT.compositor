/// created by Andrey Vasiliev

//----------------------------------------------------------------------------------------------------------------------
//
//----------------------------------------------------------------------------------------------------------------------
compositor noMRT
{
    technique
    {
        texture rt target_width target_height PF_BYTE_RGB

        target rt
        {
            pass clear {}

            pass render_scene {}
        }

        target_output
        {
            pass render_quad
            {
                material Bypass
                input 0 rt
            }
        }
    }
}

//----------------------------------------------------------------------------------------------------------------------
//
//----------------------------------------------------------------------------------------------------------------------
compositor MRT
{
    technique
    {
        texture mrt target_width target_height PF_FLOAT16_RGB PF_FLOAT16_R PF_FLOAT16_GR
        texture mrt1 target_width target_height PF_FLOAT16_R chain_scope
        texture mrt2 target_width target_height PF_FLOAT16_GR chain_scope
        texture rt target_width target_height PF_FLOAT16_RGB chain_scope

        target mrt
        {
            pass clear {}

            pass render_scene {}
        }

        target rt
        {
            pass render_quad
            {
                material Bypass
                input 0 mrt 0
            }
        }

        target mrt1
        {
            pass render_quad
            {
                material Bypass
                input 0 mrt 1
            }
        }

        target mrt2
        {
            pass render_quad
            {
                material Bypass
                input 0 mrt 2
            }
        }
    }
}

//----------------------------------------------------------------------------------------------------------------------
//
//----------------------------------------------------------------------------------------------------------------------
compositor SSAO
{
    technique
    {
        texture ssao target_width_scaled 0.5 target_height_scaled 0.5 PF_FLOAT16_R
        texture_ref rt MRT rt
        texture_ref mrt1 MRT mrt1

        target ssao
        {
            pass render_quad
            {
                material SSAO
                input 0 mrt1
            }
        }

        target ssao
        {
            pass render_quad
            {
                material FilterY
                input 0 ssao
            }
        }

        target ssao
        {
            pass render_quad
            {
                material FilterX
                input 0 ssao
            }
        }

        target rt
        {
            pass render_quad
            {
                material SSAO_mod
                input 0 rt
                input 1 ssao
            }
        }
    }
}

//----------------------------------------------------------------------------------------------------------------------
//
//----------------------------------------------------------------------------------------------------------------------
compositor Bloom
{
    technique
    {
        texture_ref rt MRT rt
        texture rt0 target_width_scaled 1 target_height_scaled 1 PF_R11G11B10_FLOAT
        texture rt1 target_width_scaled 0.5 target_height_scaled 0.5 PF_R11G11B10_FLOAT
        texture rt2 target_width_scaled 0.25 target_height_scaled 0.25 PF_R11G11B10_FLOAT
        texture rt3 target_width_scaled 0.125 target_height_scaled 0.125 PF_R11G11B10_FLOAT
        texture rt4 target_width_scaled 0.0625 target_height_scaled 0.0625 PF_R11G11B10_FLOAT
        texture rt5 target_width_scaled 0.03125 target_height_scaled 0.03125 PF_R11G11B10_FLOAT
        texture rt6 target_width_scaled 0.015625 target_height_scaled 0.015625 PF_R11G11B10_FLOAT
        texture rt7 target_width_scaled 0.0078125 target_height_scaled 0.0078125 PF_R11G11B10_FLOAT
        texture rt8 target_width_scaled 0.00390625 target_height_scaled 0.00390625 PF_R11G11B10_FLOAT
        texture rt9 target_width_scaled 0.001953125 target_height_scaled 0.001953125 PF_R11G11B10_FLOAT
        texture rt10 target_width_scaled 0.0009765625 target_height_scaled 0.0009765625 PF_R11G11B10_FLOAT

        target rt1
        {
            pass render_quad
            {
                material Bloom_threshold
                input 0 rt
            }
        }

        target rt2
        {
            pass render_quad
            {
                material Downscale3x3
                input 0 rt1
            }
        }

        target rt3
        {
            pass render_quad
            {
                material Downscale3x3
                input 0 rt2
            }
        }

        target rt4
        {
            pass render_quad
            {
                material Downscale3x3
                input 0 rt3
            }
        }

        target rt5
        {
            pass render_quad
            {
                material Downscale3x3
                input 0 rt4
            }
        }

        target rt6
        {
            pass render_quad
            {
                material Downscale3x3
                input 0 rt5
            }
        }

        target rt7
        {
            pass render_quad
            {
                material Downscale3x3
                input 0 rt6
            }
        }

        target rt8
        {
            pass render_quad
            {
                material Downscale3x3
                input 0 rt7
            }
        }

        target rt9
        {
            pass render_quad
            {
                material Downscale3x3
                input 0 rt8
            }
        }

        target rt10
        {
            pass render_quad
            {
                material Downscale3x3
                input 0 rt9
            }
        }

        target rt
        {
            pass render_quad
            {
                material Bloom_mod
                input 0 rt
                input 1 rt1
                input 2 rt2
                input 3 rt3
                input 4 rt4
                input 5 rt5
                input 6 rt6
                input 7 rt7
                input 8 rt8
            }
        }
    }
}

//----------------------------------------------------------------------------------------------------------------------
//
//----------------------------------------------------------------------------------------------------------------------
compositor Fog
{
    technique
    {
        texture_ref rt MRT rt
        texture_ref mrt1 MRT mrt1

        target rt
        {
            pass render_quad
            {
                material Fog
                input 0 rt
                input 1 mrt1
            }
        }
    }
}

//----------------------------------------------------------------------------------------------------------------------
//
//----------------------------------------------------------------------------------------------------------------------
compositor Blur
{
    technique
    {
        texture_ref mrt MRT mrt
        texture_ref rt MRT rt
        texture_ref mrt2 MRT mrt2

        target rt
        {
            pass render_quad
            {
                material Blur
                input 0 rt
                input 1 mrt2
            }
        }
    }
}

//----------------------------------------------------------------------------------------------------------------------
//
//----------------------------------------------------------------------------------------------------------------------
compositor FXAA
{
    technique
    {
        texture_ref rt MRT rt

        target rt
        {
            pass render_quad
            {
                material FXAA
                input 0 rt
            }
        }
    }
}

//----------------------------------------------------------------------------------------------------------------------
//
//----------------------------------------------------------------------------------------------------------------------
compositor Output
{
    technique
    {
        texture_ref rt MRT rt

        target_output
        {
            pass render_quad
            {
                material Output
                input 0 rt
            }
        }
    }
}
